<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìä BTC Band Monitor</title>
<style>
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    text-align: center;
    padding: 1.5em;
    color: #222;
    background: #fafafa;
  }
  h1 { font-size: 1.6em; margin-bottom: 0.2em; }
  .emoji { font-size: 3em; margin: 0.1em 0; }
  .prediction {
    font-size: 1.3em;
    font-weight: 600;
    margin-bottom: 0.3em;
  }
  .meta, .footer {
    font-size: 0.9em;
    color: #555;
    margin-top: 0.5em;
  }
  pre {
    text-align: left;
    background: #f5f5f5;
    display: inline-block;
    padding: 1em;
    border-radius: 8px;
    margin-top: 1em;
    width: 95%;
    max-width: 600px;
    overflow-x: auto;
  }
  .error { color: #b00; font-weight: 500; }
  canvas {
    margin-top: 1em;
    background: #fff;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  }
</style>
</head>
<body>

<h1>üìà BTC Band Monitor</h1>
<div id="summary">Loading latest BTC data...</div>
<canvas id="chart" width="300" height="80"></canvas>

<div class="footer">
  Auto-refreshes every 5 minutes<br>
  Source: Binance / CoinGecko ¬∑ Hosted on GitHub Pages
</div>

<script>
async function load() {
  const box = document.getElementById("summary");
  const canvas = document.getElementById("chart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  try {
    const res = await fetch("btc.json?_=" + Date.now());
    if (!res.ok) throw new Error("HTTP " + res.status);
    const d = await res.json();

    // Show summary
    if (d.error) {
      box.innerHTML = `
        <div class="emoji">‚ö™</div>
        <div class="prediction error">${d.prediction}</div>
        <div class="meta">Error: ${d.error}</div>
        <pre>${JSON.stringify(d, null, 2)}</pre>`;
      return;
    }

    box.innerHTML = `
      <div class="emoji">${d.emoji || "‚ö™"}</div>
      <div class="prediction">${d.prediction || "no data"}</div>
      <div class="meta">
        Price: <b>${d.last ?? "?"}</b> USDT<br>
        Trend: ${d.trend ?? "-"} ¬∑ RVOL: ${d.rvol ?? "-"}<br>
        Safe Bands: ${d.safe_lower ?? "-"} ‚Äì ${d.safe_upper ?? "-"}<br>
        Source: ${d.source ?? "unknown"}
      </div>
      <div class="meta" style="margin-top:0.3em;">
        Updated ${d.time ?? ""}
      </div>
      <pre>${JSON.stringify(d, null, 2)}</pre>`;

    // Draw chart if closes are included in JSON
    if (d.closes && d.closes.length > 1) {
      const closes = d.closes.slice(-20);
      const max = Math.max(...closes);
      const min = Math.min(...closes);
      const w = canvas.width, h = canvas.height;
      const xStep = w / (closes.length - 1);
      ctx.beginPath();
      ctx.moveTo(0, h - (closes[0] - min) / (max - min) * h);
      closes.forEach((p, i) => {
        const x = i * xStep;
        const y = h - (p - min) / (max - min) * h;
        ctx.lineTo(x, y);
      });
      ctx.strokeStyle = d.trend === "UP" ? "#2ecc71" : "#e74c3c";
      ctx.lineWidth = 2;
      ctx.stroke();
    } else {
      ctx.font = "12px system-ui";
      ctx.fillStyle = "#777";
      ctx.fillText("No candle data", 100, 45);
    }
  } catch (e) {
    box.innerHTML = `
      <div class="emoji">‚ö†Ô∏è</div>
      <div class="prediction error">Failed to load btc.json</div>
      <div class="meta">${e}</div>`;
  }
}

load();
setInterval(load, 300000); // every 5 minutes
</script>

</body>
</html>
